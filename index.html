<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Compatibilidade MBTI - Grupo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" />
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f8f4ff; color: #333; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #7c4dff; }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; max-width: 600px; margin: auto; }
    input { padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    .graph { height: 600px; border: 2px solid #ccc; border-radius: 10px; margin-top: 20px; }
    button { background: #7c4dff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; display: block; margin: 10px auto; }
    .highlight { background: #e0d7ff !important; }
    #pagina1, #pagina2 { display: none; }
    #pagina1.active, #pagina2.active { display: block; }
  </style>
</head>
<body>
  <div id="pagina1" class="active">
    <h1>Compatibilidade MBTI do Grupo</h1>
    <div class="form-grid" id="form">
      <input placeholder="Nome" /><input placeholder="MBTI (ex: ISFJ)" />
      <input placeholder="Nome" /><input placeholder="MBTI (ex: ESFP)" />
      <input placeholder="Nome" /><input placeholder="MBTI (ex: ISFP)" />
      <input placeholder="Nome" /><input placeholder="MBTI (ex: ISTJ)" />
      <input placeholder="Nome" /><input placeholder="MBTI (ex: ENFJ)" />
      <input placeholder="Nome" /><input placeholder="MBTI (ex: ISTP)" />
      <input placeholder="Nome" /><input placeholder="MBTI (ex: ENTP)" />
      <input placeholder="Nome" /><input placeholder="MBTI (ex: ????)" />
    </div>
    <button onclick="irParaPagina2()">Ver Compatibilidade</button>
  </div>

  <div id="pagina2">
    <h1>Mapa de Compatibilidade</h1>
    <div id="network" class="graph"></div>
    <button onclick="voltarParaPagina1()">Voltar</button>
  </div>

  <script>
    const compatibilidade = {
      'ISFJ': ['ESFP', 'ESTP', 'ISFP', 'ISTP'],
      'ESFP': ['ISFJ', 'ISTJ', 'ESTJ', 'ISFP'],
      'ISFP': ['ESFP', 'ISFJ', 'ISTP', 'INFP'],
      'ISTJ': ['ESFJ', 'ISFJ', 'ESTP'],
      'ENFJ': ['INFP', 'ISFP', 'INFJ'],
      'ISTP': ['ISFJ', 'ISFP', 'ESTP'],
      'ENTP': ['INTJ', 'INFJ', 'ENFP']
    };

    function grauCompat(mbti1, mbti2) {
      mbti1 = mbti1?.toUpperCase();
      mbti2 = mbti2?.toUpperCase();
      if (!mbti1 || !mbti2) return null;
      if (mbti1 === mbti2) return 'mesmo';
      if (compatibilidade[mbti1]?.includes(mbti2)) return 'alta';
      if (compatibilidade[mbti2]?.includes(mbti1)) return 'alta';
      return 'baixa';
    }

    function irParaPagina2() {
      document.getElementById('pagina1').classList.remove('active');
      document.getElementById('pagina2').classList.add('active');
      gerarGrafo();
    }

    function voltarParaPagina1() {
      document.getElementById('pagina2').classList.remove('active');
      document.getElementById('pagina1').classList.add('active');
    }

    function gerarGrafo() {
      const form = document.querySelectorAll('#form input');
      const pessoas = [];
      for (let i = 0; i < form.length; i += 2) {
        const nome = form[i].value.trim();
        const mbti = form[i+1].value.trim().toUpperCase();
        if (nome && mbti) pessoas.push({nome, mbti});
      }

      const nodesArr = pessoas.map((p,i) => ({id:i, label:`${p.nome}\n(${p.mbti})`}));
      const edgesArr = [];
      for (let i=0;i<pessoas.length;i++){
        for(let j=i+1;j<pessoas.length;j++){
          const tipo = grauCompat(pessoas[i].mbti,pessoas[j].mbti);
          if (!tipo || tipo === 'mesmo') continue;
          const cor = tipo === 'alta' ? 'green' : 'red';
          edgesArr.push({from:i, to:j, color:{color:cor}, label:tipo, width:3});
        }
      }

      const container = document.getElementById('network');
      const data = {nodes: new vis.DataSet(nodesArr), edges: new vis.DataSet(edgesArr)};
      const options = {
        interaction:{hover:true, selectConnectedEdges:true},
        nodes:{shape:'dot',size:25,font:{size:18,color:'#000'}, color:{background:'#a188ff',border:'#7c4dff'}},
        edges:{arrows:'to',font:{align:'middle'}, smooth:true},
        physics: {
          barnesHut: {
            gravitationalConstant: -8000,
            centralGravity: 0.3,
            springLength: 250,
            springConstant: 0.05,
            damping: 0.09
          },
          stabilization: { iterations: 250 }
        }
      };
      const network = new vis.Network(container, data, options);

      network.on('selectNode', params=>{
        data.nodes.forEach(n=>data.nodes.update({id:n.id, color:{background:'#a188ff'}}));
        params.nodes.forEach(id=>data.nodes.update({id, color:{background:'#e0d7ff'}}));
      });
    }
  </script>
</body>
</html>

