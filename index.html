<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mapa de Compatibilidade MBTI</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" rel="stylesheet" />
  <style>
    :root {
      --primary: #7c4dff;
      --primary-light: #b47cff;
      --primary-dark: #3f1dcb;
      --success: #00c853;    /* Verde - Alta compat */
      --danger: #ff1744;     /* Vermelho - Baixa compat */
      --inactive: #e2e8f0;   /* Cinza - Inativo */
      --text: #2d3748;
      --bg: #f8f4ff;
      --card-bg: #ffffff;
    }
    
    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
      line-height: 1.6;
    }
    
    h1 {
      text-align: center;
      color: var(--primary);
      margin: 30px 0;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
    }
    
    /* FORMULÁRIO COM MAIS ESPAÇO */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 25px;  /* Aumentei o gap */
      margin: 40px 0;
    }
    
    .input-group {
      margin-bottom: 15px;  /* Espaço extra entre grupos */
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--primary-dark);
    }
    
    input[type="text"], select {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;  /* Espaço abaixo dos inputs */
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 1rem;
    }
    
    /* GRÁFICO */
    .graph-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      padding: 15px;
      margin: 30px 0;
    }
    
    #network {
      height: 600px;
      width: 100%;
      border-radius: 8px;
    }
    
    /* LEGENDA */
    .legend {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }
    
    /* BOTÕES */
    .btn {
      background: var(--primary);
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      display: block;
      margin: 30px auto;
      transition: all 0.3s;
    }
    
    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    /* EFEITOS DE SELEÇÃO */
    .node-highlight {
      border: 3px solid var(--primary-light) !important;
      box-shadow: 0 0 15px rgba(124, 77, 255, 0.4);
    }
    
    .edge-active-high {
      stroke: var(--success) !important;
      stroke-width: 4px !important;
    }
    
    .edge-active-low {
      stroke: var(--danger) !important;
      stroke-width: 4px !important;
    }
    
    .edge-inactive {
      stroke: var(--inactive) !important;
      opacity: 0.5 !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- PÁGINA 1 - FORMULÁRIO -->
    <div id="pagina1" class="active">
      <h1>Compatibilidade MBTI do Grupo</h1>
      <p style="text-align: center; color: #666; margin-bottom: 30px;">
        Adicione os membros do seu grupo e descubra como os tipos de personalidade se relacionam!
      </p>
      
      <div class="form-grid" id="form">
        <!-- 8 inputs com mais espaçamento -->
        <div class="input-group">
          <label for="nome0">Membro 1</label>
          <input type="text" placeholder="Nome" id="nome0">
          <select id="mbti0"><option value="">Tipo MBTI</option></select>
        </div>
        
        <div class="input-group">
          <label for="nome1">Membro 2</label>
          <input type="text" placeholder="Nome" id="nome1">
          <select id="mbti1"><option value="">Tipo MBTI</option></select>
        </div>
        
        <!-- ... (repetir para os outros 6 membros) ... -->
      </div>
      
      <button class="btn" onclick="irParaPagina2()">Gerar Mapa</button>
    </div>

    <!-- PÁGINA 2 - VISUALIZAÇÃO -->
    <div id="pagina2">
      <h1>Mapa de Compatibilidade</h1>
      
      <div class="legend">
        <div class="legend-item">
          <div class="legend-color" style="background: var(--success);"></div>
          <span>Alta Compatibilidade</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: var(--danger);"></div>
          <span>Baixa Compatibilidade</span>
        </div>
      </div>
      
      <div class="graph-container">
        <div id="network"></div>
      </div>
      
      <button class="btn" onclick="voltarParaPagina1()">Voltar</button>
    </div>
  </div>

  <script>
    // Inicialização
    document.addEventListener('DOMContentLoaded', () => {
      const mbtiOptions = ['ISFJ','ESFJ','ISTJ','ESTJ','ISFP','ESFP','ISTP','ESTP','INFJ','ENFJ','INTJ','ENTJ','INFP','ENFP','INTP','ENTP'];
      for(let i=0; i<8; i++) {
        const sel = document.getElementById(`mbti${i}`);
        mbtiOptions.forEach(t => sel.append(new Option(t, t)));
      }
    });

    // Sistema de compatibilidade
    const compat = {
      'ISFJ': ['ESFP','ESTP','ISFP','ISTP'],
      'ESFP': ['ISFJ','ISTJ','ESTJ','ISFP'],
      'ISFP': ['ESFP','ISFJ','ISTP','INFP'],
      'ISTJ': ['ESFJ','ISFJ','ESTP']
    };
    
    function getCompatibility(type1, type2) {
      if(type1 === type2) return null;
      if(compat[type1]?.includes(type2) || compat[type2]?.includes(type1)) return 'Alta';
      return 'Baixa';
    }

    // Controle de páginas
    function irParaPagina2() {
      gerarGrafo();
      document.getElementById('pagina1').classList.remove('active');
      document.getElementById('pagina2').classList.add('active');
    }
    
    function voltarParaPagina1() {
      document.getElementById('pagina2').classList.remove('active');
      document.getElementById('pagina1').classList.add('active');
    }

    // GERAR O GRÁFICO
    function gerarGrafo() {
      const pessoas = [];
      for(let i=0; i<8; i++) {
        const nome = document.getElementById(`nome${i}`).value.trim();
        const mbti = document.getElementById(`mbti${i}`).value;
        if(nome && mbti) pessoas.push({id: i, nome, mbti});
      }
      
      // Criar nós
      const nodes = new vis.DataSet(
        pessoas.map(p => ({
          id: p.id,
          label: `${p.nome}\n${p.mbti}`,
          font: { size: 16 },
          shape: 'dot',
          size: 25,
          color: {
            background: '#fff',
            border: '#7c4dff',
            highlight: { background: '#f3efff' }
          }
        }))
      );
      
      // Criar arestas
      const edges = new vis.DataSet();
      pessoas.forEach(p1 => {
        pessoas.forEach(p2 => {
          if(p1.id >= p2.id) return; // Evitar duplicatas
          
          const compatibilidade = getCompatibility(p1.mbti, p2.mbti);
          if(!compatibilidade) return;
          
          edges.add({
            id: `${p1.id}-${p2.id}`,
            from: p1.id,
            to: p2.id,
            label: compatibilidade,
            color: {
              color: compatibilidade === 'Alta' ? '#00c853' : '#ff1744',
              highlight: '#7c4dff'
            },
            width: 3,
            arrows: { to: { enabled: true, scaleFactor: 0.7 } },
            smooth: { type: 'curvedCW', roundness: 0.2 }
          });
        });
      });
      
      // Configuração do gráfico
      const container = document.getElementById('network');
      const data = { nodes, edges };
      const options = {
        nodes: {
          borderWidth: 2,
          shadow: true,
          font: { strokeWidth: 2, strokeColor: '#fff' }
        },
        edges: {
          selectionWidth: 0, // Desativa seleção direta de arestas
          font: { strokeWidth: 2, strokeColor: '#fff', size: 14 }
        },
        physics: {
          barnesHut: { gravitationalConstant: -2000, springLength: 200 }
        },
        interaction: {
          selectConnectedEdges: true,
          hover: true
        }
      };
      
      const network = new vis.Network(container, data, options);
      
      // GERENCIAR SELEÇÃO (PARTE CRÍTICA)
      network.on('selectNode', params => {
        const nodeId = params.nodes[0];
        if(!nodeId) return;
        
        // 1. Destacar o nó selecionado
        nodes.update({ id: nodeId, color: { border: '#b47cff' } });
        
        // 2. Processar todas as arestas
        edges.forEach(edge => {
          const isConnected = edge.from === nodeId || edge.to === nodeId;
          const isHigh = edge.label === 'Alta';
          
          if(isConnected) {
            // 3. Manter a cor original (verde/vermelho) mas destacar
            edges.update({
              id: edge.id,
              color: {
                color: isHigh ? '#00c853' : '#ff1744',
                opacity: 1
              },
              width: 5
            });
          } else {
            // 4. Desbotar arestas não relacionadas
            edges.update({
              id: edge.id,
              color: { color: '#e2e8f0', opacity: 0.5 },
              width: 2
            });
          }
        });
      });
      
      network.on('deselectNode', () => {
        // Restaurar estado original
        nodes.forEach(node => {
          nodes.update({ id: node.id, color: { border: '#7c4dff' } });
        });
        
        edges.forEach(edge => {
          const isHigh = edge.label === 'Alta';
          edges.update({
            id: edge.id,
            color: { color: isHigh ? '#00c853' : '#ff1744', opacity: 1 },
            width: 3
          });
        });
      });
    }
  </script>
</body>
</html>
